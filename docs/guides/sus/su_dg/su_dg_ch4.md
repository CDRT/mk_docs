# 4 Troubleshooting

## 4.1 System Update

Typically the first step in isolating issues when running System Update is to make sure System Update can access the repository, whether that is over the Internet to access content directly from Lenovo or over an intranet network to access a local repository. Use standard network troubleshooting steps to verify the logged-on user account has access as required.

When pulling content from Lenovo, System Update uses HTTPS to access content at [https://download.lenovo.com/catalog](https://download.lenovo.com/catalog) and [https://download.lenovo.com/pccbbs](https://download.lenovo.com/pccbbs). It will also access https://chifsr.lenovomm.com to record metrics of failed updates if metrics are enabled. These sites may need to be white listed to have access through a corporate firewall. These sites are hosted on a Content Delivery Network (CDN) which consists of hundreds of "edge" servers around the world.  A device will connect to the closest edge server to download content. The specific IP addresses of the available edge servers is always changing as the CDN is being maintained. Therefore, it is not possible to provide a specific IP address or addresses for white listing.

There are no special ports required to be opened for System Update. In some cases the System Update application itself will need to be white listed to have access to the Internet. To ensure complete access for System Update to function properly, enable the following programs:

```CMD
	%PROGRAMFILES%\Lenovo\System Update\TvsuCommandLauncher.exe	

	%PROGRAMFILES%\Lenovo\System Update\Tvsukernel.exe
```

The next step would be to review the log files generated by System Update. These files can be found in C:\ProgramData\Lenovo\SystemUpdate\logs. System Update will create a new log file each time it performs a search and install session. The log file name will include a timestamp to ensure the files are unique, such as: tvsu\_200103171352.log

The log file may be quite long. If there is a particular update that is having an issue, it may help to search the log file for the title of the update. In some cases an update may not be installing because System Update has determined it is not applicable based on the package descriptor meta data for the package. It may be easier to see the results of this applicability check when running System Update by command line if the &quot;-exporttowmi&quot; parameter is used. Various tools such as WMI Explorer can be used to then view the information located at:

	root\Lenovo\Lenovo_Updates

Here you will find information similar to:

|     n2irx01w    |     Critical    |     NotApplicable    |     Intel PRO/1000 LAN Adapter Software (Windows 10 Version   1709 and 1803) - 10 [64]    |
|-----------------|-----------------|----------------------|-------------------------------------------------------------------------------------------|

The following is a list of strings that can be searched for in the log file to find certain details from the System Update session that generated the log:

- **Tvsukernel.CommandLineParameters.ValidateArguments** : This will locate the section of the log where the command line used to execute System Update is parsed. This can be useful to determine if the proper command line parameters are being used.

Example:

>Info 2020-01-03 , 05 : 13 : 56  
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at Tvsukernel.CommandLineParameters.ValidateArguments(String[] args)  
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message: The command is: 
>-search R -action INSTALL -exporttowmi -nolicense -noicon -noreboot -includerebootpackages 1,3,4,5

- **QOS (Quest OS)**: Locates the portion of the log where the device is identified where this session of System Update ran. This information will include the operating system and the Machine Type – Model of the device. The first four characters of the Machine Type – Model represents the Machine Type and will need to be specified when requesting support.

Example:

>QOS (Quest OS): Windows 10
>
>QOSLang (Quest language): EN
>
>MTM: 20N6Z4Q9US

- **Resulted order of candidate list** : This will represent the list of updates System Update found to assess for applicability.

Example:

>Message: Resulted order of candidate list:
>Alcor Micro USB Smart Card Reader Driver (Windows 10 Version 1709 or Later) - 10 [64][reboot type 0]
>
>MultiCard Reader Driver (Windows 10 Version 1709 or Later) - 10 [64][reboot type 0]
>
>Intel PRO/1000 LAN Adapter Software (Windows 10 Version 1809 or Later) - 10 [64][reboot type 0]
>
>ThinkPad Ultra/Pro/Basic Docking Station PD Controller FW Utility (Windows 10 Version 1709 or Later) - 10 [64][reboot type 0]
>
>ThinkPad Pro Docking Station DP Hub FW Utility (Windows 10 Version 1709 or Later) - 10 [64][reboot type 0]
>
>MultiCard Reader Driver (Windows 10 Version 1709 or Later) - 10 [64][reboot type 0]

- **Return install Updates** : The first occurrence of this string will locate the beginning of the process where updates are being installed.

Example:

>Info 2019-10-28 , 05 : 29 : 39
>
>	at Tvsu.Sdk.SuSdk.InstallUpdates(Update[] updatesInstall, Update[] updatesDefer, downloadingDelegate downDelegate)
>
>Message: Return install Updates

If assistance is required in troubleshooting System Update issues, please consider posting a question in the Enterprise Client Management forum which can be linked to from the Enterprise Deployment Solutions page ([https://support.lenovo.com/us/en/solutions/ht104232](https://support.lenovo.com/us/en/solutions/ht104232)). Please provide the applicable log files, the machine type (e.g. 20AN) and operating system (e.g. Windows 10 1903) where the problem is occurring, and a detailed description of the symptoms.


## 4.2 Thin Installer

Troubleshooting Thin Installer issues will generally follow the same path as troubleshooting System Update (see section above). Although Thin Installer does not pull content directly from Lenovo it may still require troubleshooting access to the local repository on the intranet network. Typically network related issues for Thin Installer are access related. For instance, if Thin Installer is launched using a process under the Local System context, it may not have access to a network share that has been granted read/write access to Everyone. This is because Thin Installer in this case is not running under the context of a known user on the domain; &quot;Everyone&quot; does not include Local System.

The log file for Thin Installer will be placed in a &quot;logs&quot; folder within the working directory of Thin Installer unless a different path is specified by the -log command line parameter or in the \<LogPath\> tag within the ThinInstaller.exe.configuration XML file. The default file name of the log file will be similar to &quot;Update\_log\_190328112207.txt&quot; with a timestamp portion to make each log file name unique.

The same search strings provided above for System Update can be used to traverse the Thin Installer log file. Likewise the &quot;-exportowmi&quot; parameter can also be used to obtain applicability status data for updates processed by Thin Installer. In addition to this information source, Thin Installer can also generate the **Update\_ApplicabilityRulesTrace.txt** by either specifying the &quot;-debug&quot; parameter; specifying the **SCAN** action; or specifying YES for \<DebugEnable\> in the ThinInstaller.exe.configuration file.

In the Update\_ApplicabilityRulesTrace.txt file, installed updates will be shown with &quot;**-DetectInstall(True)**&quot; and applicable updates will be shown with &quot;**-DetectInstall(False)**&quot; and &quot;**-Dependencies(True)**&quot;. Updates that are not applicable to the target system will be shown with &quot;**-DetectInstall(False)**&quot; and &quot;**-Dependencies(False)**&quot; as shown in the example below:

	-n2ic202w
		-DetectInstall(False),
			-Or(False),
				-_Driver(False),
					-HardwareID(NE), PCI\VEN_8086&DEV_9DA4
					-Version(NE), 10.1.15.6^
				-_Driver(False),
					-HardwareID(NE), PCI\VEN_8086&DEV_02A4
					-Version(NE), 10.1.27.2^
	
	-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-
	
	-n2ic202w
		-Dependencies(False),
			-And(False),
				-_OS(True),
					-OS(False), WIN10
					-OS(False), WIN10.*
					-OS(False), WIN10-ENT
					-OS(False), WIN10-ENT.*
					-OS(True), WIN10-PRO
					-OS(True), WIN10-PRO.*
				-_CPUAddressWidth(True),
					-AddressWidth(True), 64
				-Or(True),
					-_PnPID(True), PCI\VEN_8086&DEV_3E34
					-_PnPID(False), PCI\VEN_8086&DEV_02A4
				-_Bios(True),
					-Level(True), *
					-Level(True), N2IET*
					-Level(False), N2RET*
				-_ExternalDetection(False), %PACKAGEPATH%\inboxdrivercheck.exe 				n2ic202w_2_.xml
				-Not(True),
					-_ExternalDetection(False), %PACKAGEPATH%\getw10ver6.exe
	
	-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-o-

If assistance is required in troubleshooting Thin Installer issues, please consider posting a question in the Enterprise Client Management forum which can be linked to from the Enterprise Deployment Solutions page ([https://support.lenovo.com/us/en/solutions/ht104232](https://support.lenovo.com/us/en/solutions/ht104232)). Please provide the applicable log files, the machine type (e.g. 20AN) and operating system (e.g. Windows 10 1903) where the problem is occurring, and a detailed description of the symptoms.


## 4.3 Update Retriever

The most common issues encountered with Update Retriever are typically related to the catalogs and the content being pulled from Lenovo servers. Within the process used by Update Retriever to process catalogs for specified models, there are several CRC checks performed on the files that are downloaded. There may be times when the catalogs and the content are out of synch as the catalogs are being refreshed. In this case Update Retriever may report that it failed to download an update or may not offer any update that should be available. These types of issues are typically addressed automatically due to the continuous nature of the catalog maintenance processes but may take a day or two to be resolved. In other cases there may be an incorrect CRC value specified for a file causing it to continuously fail to download. These issues will be identified in the error messages presented by Update Retriever and can be reported in the Enterprise Client Management forum which can be linked to from the Enterprise Deployment Solutions page ([https://support.lenovo.com/us/en/solutions/ht104232](https://support.lenovo.com/us/en/solutions/ht104232)). Please specify the machine type (e.g. 20AN) and operating system combination that was used in the search.

Update Retriever does not create a log file. Instead it generates an Event Log which can be viewed by launching the Event Viewer app. In the Event Viewer, navigate to Application and Service logs > Lenovo > ThinkVantage > Update Retriever to find two event logs that can be used to troubleshoot issues.

<div style="text-align:center;padding-bottom:40px;padding-top:40px">

![](../../img/guides/su/img4-1.png)

_Figure 4-1. Update Retriever event logs_
</div>

The following list contain some common issues and how to address them:

- _System Update or Thin Installer do not see any updates in the local repository_: Verify that the Status value for the updates in the repository is set to &quot;Active&quot;. If the updates have a status of &quot;Test&quot; then System Update and Thin Installer will not see them by default.
- _An update&#39;s Reboot Type was changed from &quot;Forces Reboot&quot; to &quot;Reboot Required&quot; in Update Retriever; however, systems still reboot when the update is installed:_ In Update Retriever this setting is just a flag to indicate how an update behaves. Update Retriever cannot change how an update was designed to run. Therefore, it is typically recommended to not change this value for any updates using Update Retriever.
- _Update Retriever has been installed on a new system; however, the System List is empty:_ The System List is recorded in the registry and can be copied from the old system to the new system. Use regedit.exe to copy the &quot;Systems&quot; value from 

   ```
   Computer\HKEY\_LOCAL\_MACHINE\SOFTWARE\WOW6432Node\Lenovo
   \Update Retriever\Preferences\UserSettings\General
   ```

